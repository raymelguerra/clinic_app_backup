@using ClinicApp.Infrastructure.Data
@using ClinicApp.WebApp.Components.Dialogs
@using Microsoft.Extensions.Options
@using Oauth2.sdk.Models
@inject NavigationManager Navigation
@inject IOptions<CredentialsSettings> options

<AuthorizeView>
    <Authorized>
        <MudGrid Spacing="4" Justify="Justify.FlexEnd">
            @* <MudItem>  COMING SOON!!!!
                <MudBadge Elevation="2" Origin="Origin.TopRight" Color="Color.Error" Dot="true">
                    <MudMenu>
                        <ActivatorContent>
                            <MudIcon Icon="@Icons.Material.Outlined.Notifications" Size="Size.Medium"></MudIcon>
                        </ActivatorContent>
                        <ChildContent>
                            <MudMenuItem><MudText Typo="Typo.subtitle2"> Patient Account Problems</MudText><MudDivider Vertical="true" FlexItem="true" /> <MudChip Color="Color.Error" Size="Size.Small">5 Errors</MudChip></MudMenuItem>
                            <MudDivider />
                            <MudMenuItem><MudText Typo="Typo.subtitle2"> Services Logs Problems</MudText><MudDivider Vertical="true" FlexItem="true" /> <MudChip Color="Color.Error" Size="Size.Small">2 Errors</MudChip></MudMenuItem>
                            <MudDivider />
                            <MudMenuItem><MudText Typo="Typo.subtitle2"> Insurance Problems</MudText><MudDivider Vertical="true" FlexItem="true" /> <MudChip Color="Color.Error" Size="Size.Small">3 Errors</MudChip></MudMenuItem>
                        </ChildContent>
                    </MudMenu>
                </MudBadge>
            </MudItem> *@
            <MudItem>
                <MudMenu>
                    <ActivatorContent>
                        <MudIcon Title="@context.User.Identity?.Name" Icon="@Icons.Material.Filled.Person" Size="Size.Medium"></MudIcon>
                    </ActivatorContent>
                    <ChildContent>
                        <MudMenuItem OnClick=OpenChangePasswordDialog>Change Password</MudMenuItem>
                        <MudMenuItem OnClick="OnClick">Logout</MudMenuItem>
                    </ChildContent>
                </MudMenu>
            </MudItem>
        </MudGrid>
    </Authorized>
    <NotAuthorized>
        <MudIconButton Icon="@Icons.Material.Filled.Login" Color="Color.Inherit" Size="Size.Medium" Href="@($"login?redirectUri={Uri.EscapeDataString(Navigation.Uri)}")"></MudIconButton>

    </NotAuthorized>
</AuthorizeView>

@code {
    [Inject] private IDialogService DialogService { get; set; } = null!;
    private void OnClick(MouseEventArgs args) => Navigation.NavigateTo($"Logout", true);

    private void OpenChangePasswordDialog(MouseEventArgs args)
    {
        var options = new DialogOptions { CloseOnEscapeKey = true, MaxWidth=MaxWidth.ExtraSmall };
        DialogService.Show<ChangePasswordDialog>("Change Password", options);
    }
}
